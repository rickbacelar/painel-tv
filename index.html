<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Painel de Resultados - MC Soluções</title>
<style>
:root{
  --orange:#FF6B00;
  --dark:#2E2E2E;
  --bg:#F5F5F6;
  --card:#FFFFFF;
  --muted:#8A8A8A;
}

/* GERAL */
*{box-sizing:border-box;margin:0;padding:0;}
html,body{
  height:100%;
  font-family:'Inter', system-ui, Segoe UI, Roboto, sans-serif;
  background:var(--bg);
  color:var(--dark);
}

/* CONTAINER */
.app{
  display:flex;
  flex-direction:column;
  height:100%;
}

/* CABEÇALHO */
header{
  background:linear-gradient(90deg,var(--dark) 0%, #3C3C3C 100%);
  color:white;
  padding:20px 40px;
  display:flex;
  align-items:center;
  justify-content:space-between;
  box-shadow:0 4px 12px rgba(0,0,0,0.3);
}
.header-title{
  display:flex;
  align-items:center;
  gap:20px;
  font-weight:800;
  font-size:48px;
  letter-spacing:0.5px;
}
.logo-dot{
  width:24px;height:24px;border-radius:6px;background:var(--orange);
  box-shadow:0 3px 10px rgba(255,107,0,0.5);
}
.logo-img{
  height:110px;
  width:auto;
  object-fit:contain;
  background:#fff;
  border-radius:10px;
  padding:8px;
  box-shadow:0 0 15px rgba(0,0,0,0.2);
}

/* CONTEÚDO PRINCIPAL */
.main{
  flex:1;
  display:flex;
  flex-wrap:wrap;
  justify-content:center;
  align-items:center;
  gap:40px;
  padding:40px;
}

/* CARD */
.card{
  background:var(--card);
  border-radius:24px;
  padding:36px;
  box-shadow:0 10px 25px rgba(0,0,0,0.08);
  flex:1 1 460px;
  max-width:560px;
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
  text-align:center;
  border-top:8px solid var(--orange);
  transition:transform 0.3s ease, box-shadow 0.3s ease;
}
.card:hover{
  transform:translateY(-4px);
  box-shadow:0 14px 35px rgba(0,0,0,0.12);
}

/* TÍTULO DO CONSELHO */
.title{
  font-size:46px;
  color:var(--dark);
  font-weight:900;
  margin-bottom:28px;
  text-transform:uppercase;
  letter-spacing:1px;
}

/* INFORMAÇÕES */
.info{
  display:flex;
  flex-direction:column;
  gap:16px;
  font-size:38px;
  font-weight:600;
  color:var(--dark);
}
.info strong{
  color:var(--orange);
  font-weight:800;
}

/* RODAPÉ */
.footer{
  padding:20px 40px;
  text-align:right;
  color:var(--muted);
  font-size:28px;
  background:#EFEFEF;
  border-top:3px solid var(--orange);
}
.center{
  display:flex;
  align-items:center;
  justify-content:center;
  height:100%;
  font-size:36px;
  color:var(--dark);
}
</style>
</head>
<body>
<div class="app">
  <header>
    <div class="header-title">
      <img src="logo.png" alt="Logo MC Soluções" class="logo-img">
      <div class="logo-dot"></div>
      <div>Painel de Resultados</div>
    </div>
  </header>

  <div class="main" id="main-content">
    <div class="center" id="loading-indicator">Carregando dados...</div>
  </div>

  <div class="footer">MC Soluções ©</div>
</div>

<script>
// === CONFIGURAÇÃO ===
const fontes = [
  { id: "CREF19", url: "https://docs.google.com/spreadsheets/d/e/2PACX-1vRZt529CoSQvc13l8kopidVIRoEMCHSLFy9A-xJ9Ij440qac25VRLjDjPpskRPBOA/pub?gid=1116505710&single=true&output=csv" },
  { id: "CREF20", url: "https://docs.google.com/spreadsheets/d/e/2PACX-1vRZt529CoSQvc13l8kopidVIRoEMCHSLFy9A-xJ9Ij440qac25VRLjDjPpskRPBOA/pub?gid=195629568&single=true&output=csv" },
  { id: "CREF21", url: "https://docs.google.com/spreadsheets/d/e/2PACX-1vRZt529CoSQvc13l8kopidVIRoEMCHSLFy9A-xJ9Ij440qac25VRLjDjPpskRPBOA/pub?gid=2070528577&single=true&output=csv" },
  { id: "CRTR02", url: "https://docs.google.com/spreadsheets/d/e/2PACX-1vRZt529CoSQvc13l8kopidVIRoEMCHSLFy9A-xJ9Ij440qac25VRLjDjPpskRPBOA/pub?gid=1484490409&single=true&output=csv" },
  { id: "CRTR08", url: "https://docs.google.com/spreadsheets/d/e/2PACX-1vRZt529CoSQvc13l8kopidVIRoEMCHSLFy9A-xJ9Ij440qac25VRLjDjPpskRPBOA/pub?gid=1600799136&single=true&output=csv" },
  { id: "CRTR15", url: "https://docs.google.com/spreadsheets/d/e/2PACX-1vRZt529CoSQvc13l8kopidVIRoEMCHSLFy9A-xJ9Ij440qac25VRLjDjPpskRPBOA/pub?gid=1264950541&single=true&output=csv" },
  { id: "CRN11", url: "https://docs.google.com/spreadsheets/d/e/2PACX-1vRZt529CoSQvc13l8kopidVIRoEMCHSLFy9A-xJ9Ij440qac25VRLjDjPpskRPBOA/pub?gid=1667393760&single=true&output=csv" },
  { id: "AMMV - PIX", url: "https://docs.google.com/spreadsheets/d/e/2PACX-1vRZt529CoSQvc13l8kopidVIRoEMCHSLFy9A-xJ9Ij440qac25VRLjDjPpskRPBOA/pub?gid=1154375239&single=true&output=csv" },
  { id: "AMMV - ENEL", url: "https://docs.google.com/spreadsheets/d/e/2PACX-1vRZt529CoSQvc13l8kopidVIRoEMCHSLFy9A-xJ9Ij440qac25VRLjDjPpskRPBOA/pub?gid=393476796&single=true&output=csv" },
  { id: "STCASA", url: "https://docs.google.com/spreadsheets/d/e/2PACX-1vRZt529CoSQvc13l8kopidVIRoEMCHSLFy9A-xJ9Ij440qac25VRLjDjPpskRPBOA/pub?gid=808693567&single=true&output=csv" }
];

let cache = {};
const REFRESH_MS = 10000;

// === FUNÇÕES ===
function parseCSV(text){return text.split(/\r?\n/).map(l=>l.split(",").map(c=>c.replace(/"/g,"").trim())).filter(r=>r.length>1);}
function toNumber(v){if(!v)return 0;const cleaned=v.replace(/[^0-9,.-]/g,"").replace(/\./g,"").replace(/,/g,".");return parseFloat(cleaned)||0;}
function formatBR(v){return v?.toLocaleString("pt-BR",{style:"currency",currency:"BRL",maximumFractionDigits:0})||"R$ 0";}
async function fetchAndParse(url){try{const res=await fetch(url+"&nocache="+Date.now(),{cache:"no-store"});if(!res.ok)throw new Error(res.status);return parseCSV(await res.text());}catch(e){console.error("Erro:",e);return null;}}

// === CARREGAMENTO ===
async function loadAll(){
  for(const f of fontes){
    const rows=await fetchAndParse(f.url);
    if(!rows){cache[f.id]=null;continue;}

    const metaRow=rows.find(r=>r[0]?.toLowerCase().includes("meta"));
    const meta=metaRow?toNumber(metaRow[1]):0;

    const headerRow=rows.find(r=>r.some(c=>c.toLowerCase().includes("pago total")));
    const headerIdx=rows.indexOf(headerRow);
    const dataRow=rows[headerIdx+1]||[];

    const colPagoTotal=headerRow?.findIndex(c=>c.toLowerCase().includes("pago total"))??-1;
    const colPagoHoje=headerRow?.findIndex(c=>c.toLowerCase().includes("pago hoje"))??-1;
    const colProj=headerRow?.findIndex(c=>c.toLowerCase().includes("proj"))??-1;

    const total=colPagoTotal>=0?toNumber(dataRow[colPagoTotal]):0;
    const lastPay=colPagoHoje>=0?toNumber(dataRow[colPagoHoje]):0;
    const projRaw=colProj>=0?toNumber(dataRow[colProj]):0;
    const projPercent=meta?Math.round((total/meta)*100):(projRaw?Math.round(projRaw/meta*100):0);

    cache[f.id]={meta,total,projPercent,lastPay};
  }

  document.getElementById("loading-indicator").style.display="none";
  renderAll();
}

function renderAll(){
  const main=document.getElementById("main-content");
  main.innerHTML="";
  fontes.forEach(f=>{
    const d=cache[f.id];
    const card=document.createElement("div");
    card.className="card";
    if(!d){
      card.innerHTML=`<div class="title">${f.id}</div><div>Sem dados</div>`;
      main.appendChild(card);
      return;
    }
    card.innerHTML=`
      <div class="title">${f.id}</div>
      <div class="info">
        <div><strong>Meta Mês:</strong> ${formatBR(d.meta)}</div>
        <div><strong>Valor Total Captado:</strong> ${formatBR(d.total)}</div>
        <div><strong>Projeção:</strong> ${d.projPercent}%</div>
        <div><strong>Pagos Hoje:</strong> ${formatBR(d.lastPay)}</div>
      </div>`;
    main.appendChild(card);
  });
}

loadAll();
setInterval(loadAll, REFRESH_MS);

// === RELOAD A CADA 15s ===
setInterval(()=>location.reload(),15000);
</script>
</body>
</html>
