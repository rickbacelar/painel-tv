<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Painel de Resultados - MC Soluções</title>
<style>
:root{
  --orange:#FF6B00;
  --dark:#1E1E1E;
  --bg:#F4F4F6;
  --card:#ffffff;
  --muted:#777;
}
*{box-sizing:border-box;}
html,body{
  height:100%;
  margin:0;
  font-family:Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif;
  background:var(--bg);
  color:var(--dark);
}

/* Estrutura principal */
.app{display:flex;flex-direction:column;height:100%;}

/* HEADER */
header{
  background:linear-gradient(90deg,var(--dark),#444);
  color:white;
  padding:18px 28px;
  display:flex;
  align-items:center;
  justify-content:space-between;
}
.header-title{
  display:flex;
  align-items:center;
  gap:16px;
  font-weight:700;
  font-size:32px; /* título maior */
}
.logo-dot{
  width:20px;height:20px;border-radius:4px;background:var(--orange);
  box-shadow:0 2px 6px rgba(255,107,0,0.4);
}
.logo-img{
  height:80px;
  width:auto;
  object-fit:contain;
  background:white;
  border-radius:10px;
  padding:6px;
  box-shadow:0 0 10px rgba(0,0,0,0.25);
}

/* CARDS */
.main{
  flex:1;
  display:flex;
  flex-wrap:wrap;
  gap:28px;
  padding:28px;
  justify-content:center;
  align-items:stretch;
}

.card{
  background:var(--card);
  border-radius:20px;
  padding:28px;
  box-shadow:0 10px 24px rgba(0,0,0,0.1);
  flex:1 1 400px;
  max-width:500px;
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
  text-align:center;
  transition:transform 0.3s;
}
.card:hover{transform:scale(1.02);}

.title{
  font-size:32px;
  color:var(--dark);
  margin-bottom:20px;
  font-weight:800;
}

/* Informações principais */
.info{
  display:flex;
  flex-direction:column;
  gap:14px;
  font-size:26px;
  font-weight:600;
  line-height:1.5;
}
.info strong{
  font-size:28px;
  color:#222;
}

/* FOOTER */
.footer{
  padding:16px 24px;
  text-align:right;
  color:var(--muted);
  font-size:20px;
}
.center{
  display:flex;
  align-items:center;
  justify-content:center;
  height:100%;
  font-size:26px;
}
</style>
</head>
<body>
<div class="app">
  <header>
    <div class="header-title">
      <img src="logo.png" alt="Logo MC Soluções" class="logo-img">
      <div class="logo-dot"></div>
      <div>Painel de Resultados</div>
    </div>
  </header>

  <div class="main" id="main-content">
    <div class="center" id="loading-indicator">Carregando dados...</div>
  </div>

  <div class="footer">MC Soluções ©</div>
</div>

<script>
// === CONFIGURAÇÃO ===
const fontes = [
  { id: "CREF19", url: "https://docs.google.com/spreadsheets/d/e/2PACX-1vRZt529CoSQvc13l8kopidVIRoEMCHSLFy9A-xJ9Ij440qac25VRLjDjPpskRPBOA/pub?gid=1116505710&single=true&output=csv" },
  { id: "CREF20", url: "https://docs.google.com/spreadsheets/d/e/2PACX-1vRZt529CoSQvc13l8kopidVIRoEMCHSLFy9A-xJ9Ij440qac25VRLjDjPpskRPBOA/pub?gid=195629568&single=true&output=csv" },
  { id: "CREF21", url: "https://docs.google.com/spreadsheets/d/e/2PACX-1vRZt529CoSQvc13l8kopidVIRoEMCHSLFy9A-xJ9Ij440qac25VRLjDjPpskRPBOA/pub?gid=2070528577&single=true&output=csv" },
  { id: "CRTR02", url: "https://docs.google.com/spreadsheets/d/e/2PACX-1vRZt529CoSQvc13l8kopidVIRoEMCHSLFy9A-xJ9Ij440qac25VRLjDjPpskRPBOA/pub?gid=1484490409&single=true&output=csv" },
  { id: "CRTR08", url: "https://docs.google.com/spreadsheets/d/e/2PACX-1vRZt529CoSQvc13l8kopidVIRoEMCHSLFy9A-xJ9Ij440qac25VRLjDjPpskRPBOA/pub?gid=1600799136&single=true&output=csv" },
  { id: "CRTR15", url: "https://docs.google.com/spreadsheets/d/e/2PACX-1vRZt529CoSQvc13l8kopidVIRoEMCHSLFy9A-xJ9Ij440qac25VRLjDjPpskRPBOA/pub?gid=1264950541&single=true&output=csv" },
  { id: "CRN11", url: "https://docs.google.com/spreadsheets/d/e/2PACX-1vRZt529CoSQvc13l8kopidVIRoEMCHSLFy9A-xJ9Ij440qac25VRLjDjPpskRPBOA/pub?gid=1667393760&single=true&output=csv" },
  { id: "AMMV - PIX", url: "https://docs.google.com/spreadsheets/d/e/2PACX-1vRZt529CoSQvc13l8kopidVIRoEMCHSLFy9A-xJ9Ij440qac25VRLjDjPpskRPBOA/pub?gid=1154375239&single=true&output=csv" },
  { id: "AMMV - ENEL", url: "https://docs.google.com/spreadsheets/d/e/2PACX-1vRZt529CoSQvc13l8kopidVIRoEMCHSLFy9A-xJ9Ij440qac25VRLjDjPpskRPBOA/pub?gid=393476796&single=true&output=csv" },
  { id: "STCASA", url: "https://docs.google.com/spreadsheets/d/e/2PACX-1vRZt529CoSQvc13l8kopidVIRoEMCHSLFy9A-xJ9Ij440qac25VRLjDjPpskRPBOA/pub?gid=808693567&single=true&output=csv" }
];

let cache = {};
const REFRESH_MS = 10000; // Atualiza dados a cada 10s

// === FUNÇÕES AUXILIARES ===
function parseCSV(text){return text.split(/\r?\n/).map(l=>l.split(",").map(c=>c.replace(/"/g,"").trim())).filter(r=>r.length>1);}
function toNumber(v){if(!v)return 0;const cleaned=v.replace(/[^0-9,.-]/g,"").replace(/\./g,"").replace(/,/g,".");return parseFloat(cleaned)||0;}
function formatBR(v){return v?.toLocaleString("pt-BR",{style:"currency",currency:"BRL",maximumFractionDigits:0})||"R$ 0";}
async function fetchAndParse(url){try{const res=await fetch(url+"&nocache="+Date.now(),{cache:"no-store"});if(!res.ok)throw new Error(res.status);return parseCSV(await res.text());}catch(e){console.error("Erro:",e);return null;}}

// === CARREGAMENTO ===
async function loadAll(){
  for(const f of fontes){
    const rows=await fetchAndParse(f.url);
    if(!rows){cache[f.id]=null;continue;}

    const metaRow=rows.find(r=>r[0]?.toLowerCase().includes("meta"));
    const meta=metaRow?toNumber(metaRow[1]):0;

    const headerRow=rows.find(r=>r.some(c=>c.toLowerCase().includes("pago total")));
    const headerIdx=rows.indexOf(headerRow);
    const dataRow=rows[headerIdx+1]||[];

    const colPagoTotal=headerRow?.findIndex(c=>c.toLowerCase().includes("pago total"))??-1;
    const colPagoHoje=headerRow?.findIndex(c=>c.toLowerCase().includes("pago hoje"))??-1;
    const colProj=headerRow?.findIndex(c=>c.toLowerCase().includes("proj"))??-1;

    const total=colPagoTotal>=0?toNumber(dataRow[colPagoTotal]):0;
    const lastPay=colPagoHoje>=0?toNumber(dataRow[colPagoHoje]):0;
    const projRaw=colProj>=0?toNumber(dataRow[colProj]):0;
    const projPercent=meta?Math.round((total/meta)*100):(projRaw?Math.round(projRaw/meta*100):0);

    cache[f.id]={meta,total,projPercent,lastPay};
  }

  document.getElementById("loading-indicator").style.display="none";
  renderAll();
}

function renderAll(){
  const main=document.getElementById("main-content");
  main.innerHTML="";
  fontes.forEach(f=>{
    const d=cache[f.id];
    const card=document.createElement("div");
    card.className="card";
    if(!d){
      card.innerHTML=`<div class="title">${f.id}</div><div>Sem dados</div>`;
      main.appendChild(card);
      return;
    }
    card.innerHTML=`
      <div class="title">${f.id}</div>
      <div class="info">
        <div><strong>Meta Mês:</strong> ${formatBR(d.meta)}</div>
        <div><strong>Valor Total Captado:</strong> ${formatBR(d.total)}</div>
        <div><strong>Projeção:</strong> ${d.projPercent}%</div>
        <div><strong>Pagos Hoje:</strong> ${formatBR(d.lastPay)}</div>
      </div>`;
    main.appendChild(card);
  });
}

loadAll();
setInterval(loadAll, REFRESH_MS);

// === RECARREGAR PÁGINA A CADA 15 SEGUNDOS ===
const PAGE_RELOAD_MS = 15000;
setInterval(()=>{
  const urlBase = window.location.pathname + window.location.search.replace(/([?&])_=[^&]*/,'');
  const separator = urlBase.includes('?') ? '&' : '?';
  const newUrl = urlBase + separator + '_=' + Date.now();
  window.location.replace(newUrl);
}, PAGE_RELOAD_MS);
</script>
</body>
</html>
